/*------------------------------------------------------------ */
/* Mixins
-------------------------------------------------------------- */

@mixin rhythm() {
  @include set-sizes(1);
  // Loop through all breakpoints.
  @for $i from 2 through length($breakpoints) {
    @include breakpoint(bp-name($i)) {
      @include set-sizes($i);
    }
  }
}

// $i is breakpoint number (1 through number of breakpoints defined in $breakpoints map)
@mixin set-sizes($i) {
  $base-font-size:         bp-base-font-size($i);
  $base-line-height:       bp-base-line-height($i);
  $base-line-height-ratio: bp-base-line-height-ratio($i);
  $scale-values:           bp-scale-values($i);

  font-size:   to-rem($base-font-size);
  line-height: $base-line-height-ratio;

  @at-root .tera {
    $tera: to-rem(nth($scale-values, 9));
    font-size: $tera;
    line-height: line-height($tera, $i);
  }
  @at-root .giga {
    $giga: to-rem(nth($scale-values, 8));
    font-size: $giga;
    line-height: line-height($giga, $i);
  }
  @at-root .mega {
    $mega: to-rem(nth($scale-values, 7));
    font-size: $mega;
    line-height: line-height($mega, $i);
  }
  @at-root h1, .h1, .alpha {
    $alpha: to-rem(nth($scale-values, 6));
    font-size: $alpha;
    line-height: line-height($alpha, $i);
  }
  @at-root h2, .h2, .beta {
    $beta: to-rem(nth($scale-values, 5));
    font-size: $beta;
    line-height: line-height($beta, $i);
  }
  @at-root h3, .h3, .gamma {
    $gamma: to-rem(nth($scale-values, 4));
    font-size: $gamma;
    line-height: line-height($gamma, $i);
  }
  @at-root h4, .h4, .delta {
    $delta: to-rem(nth($scale-values, 3));
    font-size: $delta;
    line-height: line-height($delta, $i);
  }
  @at-root h5, .h5, .epsilon {
    $epsilon: to-rem(nth($scale-values, 2));
    font-size: $epsilon;
    line-height: line-height($epsilon, $i);
  }
  @at-root h6, .h6, .zeta {
    $zeta: to-rem(nth($scale-values, 1));
    font-size: $zeta;
    line-height: line-height($zeta, $i);
  }

  @at-root section, .section {
    margin: 0 auto;
    max-width: to-rem(max-line-width($base-font-size, $base-line-height-ratio));
  }
}

// Breakpoints.
// Parts based on https://gist.github.com/timknight/03e6335b8816aa534cf7 and
// https://github.com/designbyjake/sassline/blob/master/assets/sass/base/_mixins.scss
@mixin breakpoint($breakpoint-name: all) {
  // Type of break variable
  $value: type-of($breakpoint-name);

  // If it is a string (i.e. a breakpoint variable).
  @if $value == string {
    // If using 'bp-1', 'bp-2' etc output the correct breakpoints from map.
    @if map-has-key($breakpoints, $breakpoint-name) {
      $breakpoints: map-get($breakpoints, $breakpoint-name);
      @if map-has-key($breakpoints, breakpoint) {
        @media screen and (min-width: #{to-rem(map-get($breakpoints, breakpoint))} ) { @content; }
      } @else {
        @warn "#{$breakpoint-name} does not have a defined `breakpoint` value.";
      }
    } @else if $breakpoint-name == all {
      @media all { @content; }
    } @else {
      @warn "`#{$breakpoint-name}` is not valid to use as a breakpoint. `all` was used instead.";
      @media all { @content; }
    }

  // If it is a number, use this for the breakpoint.
  } @else if $value == number {
    @media screen and (min-width: #{to-px($breakpoint-name)}) { @content; }
  } @else {
    @warn "`#{$breakpoint-name}` is not valid to use as a breakpoint. `all` was used instead";
    @media all { @content; }
  }
}

@mixin font-size($font-size, $inline: false) {
  font-size:   to-rem($font-size);
  @if $inline == false {
    line-height: line-height($font-size, 1);
  }
  // Loop through all breakpoints.
  @for $i from 2 through length($breakpoints) {
    @include breakpoint(bp-name($i)) {
      font-size:   to-rem($font-size);
      @if $inline == false {
        line-height: line-height($font-size, $i);
      }
    }
  }
}

@mixin padding($scale: 1 0, $decimal: false) {
  @if $decimal {
    $scale: $scale;
  } @else {
    @for $i from 1 through length($scale) {
      $scale: set-nth($scale, $i, round(nth($scale, $i)));
    }
  }
  // round $scale because only whole integers can be used to maintain the rhythm
  // Technically, as long the top and bottom values sum to a whole integer, you are fine but we won't worry about that case for now
  @if length($scale) == 1 {
    padding: line-height(bp-base-font-size(1), 1) * nth($scale, 1);
    // Loop through all breakpoints.
    @for $i from 2 through length($breakpoints) {
      @include breakpoint(bp-name($i)) {
        padding: line-height(bp-base-font-size($i), $i) * nth($scale, 1);
      }
    }
  } @else if length($scale) == 2 {
    padding: (line-height(bp-base-font-size(1), 1) * nth($scale, 1)) (line-height(bp-base-font-size(1), 1) * nth($scale, 2));
    // Loop through all breakpoints.
    @for $i from 2 through length($breakpoints) {
      @include breakpoint(bp-name($i)) {
        padding: (line-height(bp-base-font-size($i), $i) * nth($scale, 1)) (line-height(bp-base-font-size($i), $i) * nth($scale, 2));
      }
    }
  } @else if length($scale) == 3 {
    padding: (line-height(bp-base-font-size(1), 1) * nth($scale, 1)) (line-height(bp-base-font-size(1), 1) * nth($scale, 2)) (line-height(bp-base-font-size(1), 1) * nth($scale, 3));
    // Loop through all breakpoints.
    @for $i from 2 through length($breakpoints) {
      @include breakpoint(bp-name($i)) {
        padding: (line-height(bp-base-font-size($i), $i) * nth($scale, 1)) (line-height(bp-base-font-size($i), $i) * nth($scale, 2)) (line-height(bp-base-font-size($i), $i) * nth($scale, 3));
      }
    }
  } @else if length($scale) == 4 {
    padding: (line-height(bp-base-font-size(1), 1) * nth($scale, 1)) (line-height(bp-base-font-size(1), 1) * nth($scale, 2)) (line-height(bp-base-font-size(1), 1) * nth($scale, 3)) (line-height(bp-base-font-size(1), 1) * nth($scale, 4));
    // Loop through all breakpoints.
    @for $i from 2 through length($breakpoints) {
      @include breakpoint(bp-name($i)) {
        padding: (line-height(bp-base-font-size($i), $i) * nth($scale, 1)) (line-height(bp-base-font-size($i), $i) * nth($scale, 2)) (line-height(bp-base-font-size($i), $i) * nth($scale, 3)) (line-height(bp-base-font-size($i), $i) * nth($scale, 4));
      }
    }
  } @else {
    @error "Invalid number of padding values. Use 1, 2, 3, or 4 values only.";
  }
}

@mixin margin($scale: 1 0, $decimal: false) {
  @if $decimal {
    $scale: $scale;
  } @else {
    @for $i from 1 through length($scale) {
      $scale: set-nth($scale, $i, round(nth($scale, $i)));
    }
  }
  @if length($scale) == 1 {
    margin: line-height(bp-base-font-size(1), 1) * nth($scale, 1);
    // Loop through all breakpoints.
    @for $i from 2 through length($breakpoints) {
      @include breakpoint(bp-name($i)) {
        margin: line-height(bp-base-font-size($i), $i) * nth($scale, 1);
      }
    }
  } @else if length($scale) == 2 {
    margin: (line-height(bp-base-font-size(1), 1) * nth($scale, 1)) (line-height(bp-base-font-size(1), 1) * nth($scale, 2));
    // Loop through all breakpoints.
    @for $i from 2 through length($breakpoints) {
      @include breakpoint(bp-name($i)) {
        margin: (line-height(bp-base-font-size($i), $i) * nth($scale, 1)) (line-height(bp-base-font-size($i), $i) * nth($scale, 2));
      }
    }
  } @else if length($scale) == 3 {
    margin: (line-height(bp-base-font-size(1), 1) * nth($scale, 1)) (line-height(bp-base-font-size(1), 1) * nth($scale, 2)) (line-height(bp-base-font-size(1), 1) * nth($scale, 3));
    // Loop through all breakpoints.
    @for $i from 2 through length($breakpoints) {
      @include breakpoint(bp-name($i)) {
        margin: (line-height(bp-base-font-size($i), $i) * nth($scale, 1)) (line-height(bp-base-font-size($i), $i) * nth($scale, 2)) (line-height(bp-base-font-size($i), $i) * nth($scale, 3));
      }
    }
  } @else if length($scale) == 4 {
    margin: (line-height(bp-base-font-size(1), 1) * nth($scale, 1)) (line-height(bp-base-font-size(1), 1) * nth($scale, 2)) (line-height(bp-base-font-size(1), 1) * nth($scale, 3)) (line-height(bp-base-font-size(1), 1) * nth($scale, 4));
    // Loop through all breakpoints.
    @for $i from 2 through length($breakpoints) {
      @include breakpoint(bp-name($i)) {
        margin: (line-height(bp-base-font-size($i), $i) * nth($scale, 1)) (line-height(bp-base-font-size($i), $i) * nth($scale, 2)) (line-height(bp-base-font-size($i), $i) * nth($scale, 3)) (line-height(bp-base-font-size($i), $i) * nth($scale, 4));
      }
    }
  } @else {
    @error "Invalid number of margin values. Use 1, 2, 3, or 4 values only.";
  }
}

/*------------------------------------------------------------ */
/* Drop caps
-------------------------------------------------------------- */

@mixin dropcap($float-position, $font-size, $font-family, $txt-indent, $margin, $padding, $color, $line-height, $bg) {
  &:first-letter {
    float: $float-position;
    margin: $margin;
    padding: $padding;
    font-size: $font-size;
    font-family: $font-family;
    line-height: $line-height;
    text-indent: $txt-indent;
    background: $bg;
    color: $color;
  }
}
